{include file=member.header.html}
<script  type="text/javascript" src="../../static/expand/my97date/wdatepicker.js"></script>
<div class="w">
  <div class="AreaBox clearfix">
     {include file=member.menu.html}
    
    <div class="con">
    	<form id="myform" action="" method="post">
        <div class="">
            <h2 class="tit">企业法人信息</h2>
            <fieldset class="certify_form">
                <div class="ui-form-item">
                    <label class="ui-label"><span class="ui-form-required">*</span>企业法人真实姓名：</label>
                    <input type="text" class="ui-input" value="{$auth.legal_real_name}" name="legal_real_name" placeholder="企业法人真实姓名" validate="required"/>
    
                    <div class="ui-form-explain"></div>
                    <p class="ui-form-explain-sub">
                        请确保您填写的姓名与身份证原件上的姓名一致。<br/>
                        为保障您的资金安全，实名认证姓名和身份证号须和您提现的银行卡的户名保持一致。
                    </p>
                </div>
                <div class="ui-form-item">
                    <label class="ui-label"><span class="ui-form-required">*</span>身份证号码：</label>
                    <input type="text" class="ui-input" name="legal_card" value="{$auth.legal_card}" placholder="" validate="required|idcard" placeholder="身份证号码" maxlength="18" />
    
                    <div class="ui-form-explain"></div>
                </div>
    
                <div class="ui-form-item" id="j-validate-expire2">
                    <label class="ui-label" for="j-cal-trigger2"><span class="ui-form-required">*</span>身份证有效期：</label>
                    
                    
                    <input type="text" onclick="WdatePicker({minDate:'%y-%M-%d'})" value="{if $auth.legal_card_long == 0}{$auth.legal_card_due}{/if}" name="legal_card_due" validate="required" placeholder="身份证有效期" id="idcard" class="ui-input Wdate" {if $auth.legal_card_long == 1}disabled="disabled"{/if}>
                    <label class="ui-label ui-label-inline ui-label-longtime">
                        <input type="checkbox" name="legal_card_long" value="1" class="idcardtime fl" {if $auth.legal_card_long == 1}checked{/if}>长期
                    </label>



    
                    <div class="ui-form-explain"></div>
                    <p class="ui-form-explain-sub">若证件有效期为长期，请勾选长期。</p>
                </div>
    
                <div class="ui-form-item">
            <label class="ui-label"><span class="ui-form-required">*</span>身份证图片：</label>
            <div validate="idcardA" class="upload-id" id="uploadPicIdFront">
            
            			 <div class="upload-pic-btn">
			              <img src="{if $auth.legal_card_face_img}{$auth.legal_card_face_img}{else}../../static/img/idfront.png{/if}" style="width:100px;height:97px;" alt="" data-img="{if $auth.legal_card_face_img}{$auth.legal_card_face_img}{else}../../static/img/idfront.png{/if}" class="def_legal_card_face_img">
			              <!-- 取消上传操作需要修改的val值 -->
			               <input type="hidden" name="hid_legal_card_face_cancel" id="hid_legal_card_face_cancel" value="">;
			              	<!-- 上传图片完成要展示的 -->
			                <div class="upload-wrap up_legal_card_face_hid" {if $auth.legal_card_face_img}style="display:block"{/if}> <a href="{$auth.legal_card_face_img}" target="_blank" class="upload-link see_legal_card_face_img" title="点击查看大图">查看</a> 
			                <a href="javascript:;" onclick="delfile('legal_card_face_img','businessauth','legal_card_face_img',{$auth.id})" class="deletefile delete" action-type="deletefile">×</a> 
			                </div>
			                
			                <input type="file" {if $auth.legal_card_face_img}style="display:none"{/if} onchange="selfile('legal_card_face_img')" name="legal_card_face_img" id="legal_card_face_img" data-progressid="2842923581773.134" name="file" size="100" class="ui-upload-btn">
			              </div>
			              
			              <!-- 这里隐藏的是图片路径 form提交的时候会用到 -->
			              <input type="hidden" name="hid_legal_card_face_img" id="hid_legal_card_face_img" value="{if $auth.legal_card_face_img}{$auth.legal_card_face_img_data}{/if}"> 
			              <div class="error legal_card_face_img_error"></div>
			               <!-- 正在上传中的时候需要调用的 -->
			              <ul class="uploadfile-indicator clearfix legal_card_face_img">
			                  <li data-pid="2842924317781.58" class="clearfix" style="display: block;"><p class="file clearfix"><span class="fl">ico1_1024_1024.png</span></p>
			                 <div class="adding clearfix"><p class="adifile"><span style="width:0%"></span></p><p class="fl">正在上传中....</p>
			                 <a action-type="cancel" class="fr" onclick="cancelImg('legal_card_face_img')" href="javascript:;">取消</a>
			                 </div>
			                </li>
			              </ul>
              
            </div>
          </div>
          		<div class="ui-form-item">
            <label class="ui-label"></label>
            <div validate="idcardB" class="upload-id" id="uploadPicIdBack" style="margin-bottom: 20px;">
            
               			<div class="upload-pic-btn">
			              <img src="{if $auth.legal_card_back_img}{$auth.legal_card_back_img}{else}../../static/img/idback.png{/if}" style="width:100px;height:97px;" alt="" data-img="{if $legal_card_back_img}{$legal_card_back_img}{else}../../static/img/idback.png{/if}" class="def_legal_card_back_img">
			              <!-- 取消上传操作需要修改的val值 -->
			               <input type="hidden" name="hid_legal_card_back_cancel" id="hid_legal_card_back_cancel" value="">;
			              	<!-- 上传图片完成要展示的 -->
			                <div class="upload-wrap up_legal_card_back_hid" {if $auth.legal_card_back_img}style="display:block"{/if}> <a href="{$auth.legal_card_back_img}" target="_blank" class="upload-link see_legal_card_back_img" title="点击查看大图">查看</a> 
			                <a href="javascript:;" onclick="delfile('legal_card_back_img','businessauth','legal_card_back_img',{$auth.id})" class="deletefile delete" action-type="deletefile">×</a> 
			                </div>
			                
			                <input type="file"  {if $auth.legal_card_back_img}style="display:none"{/if} onchange="selfile('legal_card_back_img')" name="legal_card_back_img" id="legal_card_back_img" data-progressid="2842923581773.134" name="file" size="100" class="ui-upload-btn">
			              </div>
			              
			              <!-- 这里隐藏的是图片路径 form提交的时候会用到 -->
			              <input type="hidden" name="hid_legal_card_back_img" id="hid_legal_card_back_img" value="{if $auth.legal_card_back_img}{$auth.legal_card_back_img_data}{/if}"> 
			              <div class="error legal_card_back_img_error"></div>
			               <!-- 正在上传中的时候需要调用的 -->
			              <ul class="uploadfile-indicator clearfix legal_card_back_img">
			                  <li data-pid="2842924317781.58" class="clearfix" style="display: block;"><p class="file clearfix"><span class="fl">ico1_1024_1024.png</span></p>
			                 <div class="adding clearfix"><p class="adifile"><span style="width:0%"></span></p><p class="fl">正在上传中....</p>
			                 <a action-type="cancel" class="fr" onclick="cancelImg('legal_card_back_img')" href="javascript:;">取消</a>
			                 </div>
			                </li>
			              </ul>
              
            </div>
            <p class="ui-form-explain-sub">
              <span>请上传有效的身份证图片，非证件图片不予受理,证件要求：</span><br/>
                1、证件必须包含身份证正面和背面两面信息<br />
                2、必须为清晰彩色原件扫描件或数码照，仅支持.jpg.bmp.png.gif的图片格式，图片大小不超过2M<br />
                3、身份证必须在有效期内。<br />
              </p>
          </div>
    
                <div class="ui-form-item ui-form-item-submit">
                    <span class="ui-button-morange ui-button">
                    <input type="hidden" name="step" value="2" />
                        <input class="btn-1" value="提交审核" type="submit" id="submit-btn">
                        <input class="btn-2" value="返回" type="button" onclick="backStep()"/>
                    </span>
                </div>
            </fieldset>
        </div>
        </form>
        <script type="text/javascript" src="/static/expand/jquery.form.js"></script>
        <script>
        
        /**
		*上传图片
		*/
		function selfile(type)
		{
			var r  = 10000*Math.random();
			if(type == 'legal_card_face_img')
			{
				$(".legal_card_face_img").css("display",'block')			
			}
			else if(type == 'legal_card_back_img')
			{
				$(".legal_card_back_img").css("display",'block')
			}
			else if(type == "business_seal_img")
			{
				$(".business_seal_img").css("display",'block')
			}
			
			//fd.append('pic',pic);
			 $('#myform').ajaxSubmit({
			        url:'{link app=auth act=upload}?&type='+type+'&r='+r,
			        type:"post",
			        success: function(res) {
			            var res = $.parseJSON(res);
			            if(res.done==true)
			            {
			            	if(res.retval.type == 'legal_card_face_img')
			            	{
			            		//alert('aa')
			            		//如果$("#hid_face_cancel").val（）值为1 说明 在上传之前执行了 取消操作;
			            		if($("#hid_legal_card_face_cancel").val())
		            			{
			            			$("#hid_legal_card_face_cancel").val('');
		            				return;
		            			}
			            		
			            		$(".legal_card_face_img").css("display",'none') 
			            		
			            		//更换缩罗图的地址
								$(".def_legal_card_face_img").attr('src',res.retval.src);
								$(".def_legal_card_face_img").attr('data-img',res.retval.src);
								
								//input file隐藏
								$("#legal_card_face_img").css("display",'none')
								;
								//input hidden 隐藏域的值
								$("#hid_legal_card_face_img").val(res.retval.name)
								
								//缩罗图展开 查看按钮
								$(".up_legal_card_face_hid").css("display",'block');
								$(".see_legal_card_face_img").attr("href",res.retval.src);
								
								//错误提示
								$(".legal_card_face_img_error").html('');
								
			            	}
			            	else if(res.retval.type == 'legal_card_back_img')
			            	{
			            		//如果$("#hid_face_cancel").val（）值为1 说明 在上传之前执行了 取消操作;
			            		if($("#hid_legal_card_back_cancel").val())
		            			{
			            			$("#hid_legal_card_back_cancel").val('');
		            				return;
		            			}
			            		
			            		
								$(".legal_card_back_img").css("display",'none') 
			            		
			            		//更换缩罗图的地址
								$(".def_legal_card_back_img").attr('src',res.retval.src);
								$(".def_legal_card_back_img").attr('data-img',res.retval.src);
								
								//input file隐藏
								$("#legal_card_back_img").css("display",'none')
								;
								//修改隐藏域的值
								$("#hid_legal_card_back_img").val(res.retval.name)
								
								//缩罗图展开 查看按钮
								$(".up_legal_card_back_hid").css("display",'block');
								$(".see_legal_card_back_img").attr("href",res.retval.src);
								
								//清空错误提示
								$(".legal_card_back_img_error").html('');
			            	}
			            	
			                return;
			            }
			            else
			            {
			                alert(res.msg)
			            }
			        }
			    });
		}
		
		/**
		*点击删除图片事件
		*1 是删除正面图   2是删除反面图
		*/
		function delfile(type,model,field,auth_id=0)
		{
			if(type == 'legal_card_face_img')
			{
				var img = $("#hid_legal_card_face_img").val();
				//=====ajax删除session或者auth表中存在的图片=====
				$.ajax({
					   type: "POST",
					   url: "{link app=auth act=del_file}",
					   data: "type=1&img="+img+"&model="+model+"&field="+field+"&id="+auth_id,
					   success: function(msg){
						   var res = $.parseJSON(msg);
				            if(res.done==true)
			            	{
			            		//alert('suceess')
			            	}
				            else
			            	{
				            	alert(res.msg);
			            		return;
			            	}
					   }
					});
				
				$(".up_legal_card_face_hid").css("display",'none'); 
				$("#legal_card_face_img").css("display",'block');
				$(".def_legal_card_face_img").attr('src',"../../static/img/idfront.png");
				$(".def_legal_card_face_img").attr('data-img',"../../static/img/idfront.png");
				//修改隐藏域的值
				$("#hid_legal_card_back_img").val('')
			}
			else if(type == "legal_card_back_img")
			{
				var img = $("#hid_legal_card_back_img").val();
				//=====ajax删除session或者auth表中存在的图片=====
				$.ajax({
					   type: "POST",
					   url: "{link app=auth act=del_file}",
					   data: "type=2&img="+img+"&model="+model+"&field="+field+"&id="+auth_id,
					   success: function(msg){
						   var res = $.parseJSON(msg);
				            if(res.done==true)
			            	{
			            		//alert('suceess')
			            	}
				            else
				            {
				            	alert(res.msg);
				            	return ;	
				            }
					   }
					});
				
				$(".up_legal_card_back_hid").css("display",'none'); 
				$("#legal_card_back_img").css("display",'block');
				$(".def_legal_card_back_img").attr('src',"../../static/img/idback.png");
				$(".def_legal_card_back_img").attr('data-img',"../../static/img/idback.png");
				//修改隐藏域的值
				$("#hid_legal_card_back_img").val('')
			}
			
			
		}
		
		/**
		*取消上传的操作
		*这部操作不仅要隐藏html代码 还要去服务器删除对应的图片
		*/
		function cancelImg(type)
		{
			if(type == 'legal_card_face_img')
			{
				//隐藏
				$(".legal_card_face_img").css("display",'none');
				
				//给隐藏的input赋
				$("#hid_legal_card_face_cancel").val(1);
				
			}
			else if(type == "legal_card_back_img")
			{
				//隐藏
				$(".legal_card_back_img").css("display",'none');
				//给隐藏的input赋
				$("#hid_legal_card_back_cancel").val(1);
				
			}
			
			
		}
        
        $('#myform').verify({
			validate:{
					idcardA:function(e){
						if(e.find('.upload-wrap').is(':hidden')){
							e.find('.error').text('请上传您的身份证正面图').show()
						}	
					},
					idcardB:function(e){
						if(e.find('.upload-wrap').is(':hidden')){
							e.find('.error').text('请上传您的身份证背面图').show()
						}	
					}
				},
			submitBtn:{
				flag:true,
				id:$('#submit-btn'),
				txt:'提交中...'
			}
		});
		$('.idcardtime').click(function(){
			if(this.checked){
				$('#idcard').val('长期').attr('disabled',true).parents('.ui-form-item').find('.error').text('');
			}else{
				var business_life = "{$auth.legal_card_due}";
				$('#idcard').val(business_life).attr('disabled',false)	
			}
		})
		
		/**
		*返回上一部
		*/
		function backStep()
		{
			window.location.href="{link app=member act=tailor arg0=auth_business_info}?type=1";
		}
		
        </script>
    </div>
  </div>
</div>

{include file="footer.html"}
